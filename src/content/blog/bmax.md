---
author: matac
pubDatetime: 2023-09-06T22:27:00.000Z
title: BMAX(MiniPC)を何かしらに使いたい
slug: bmax
featured: false
draft: false
tags:
  - tec
  - infra
ogImage: ""
description: |
  1月に買ったMiniPCのBMAXを腐らせていたので何かに使いたい
_template: blog_post
---

当時12,000円で売ってて手が滑って買ってしまったMiniPCの[BMAX](https://amzn.asia/d/iyYFbBI)を全然活用することなく放置していた。まあ手が滑ってというのは冗談で研究室に置いておいて踏み台サーバーとして使おうとしたがVPNを直しちゃったのでなんか使い道なくなったという感じだ(実は踏み台も他にあるので手が滑ったと言う方が正確かもしれない...)。今は研究室から持って帰ってきて自宅のデスクに置いているのだが普通のデスクトップPCとして使うにはスペックが低くて結局放置していた。

流石に勿体無いと思ったので何かしらのサーバーにしようということで色々突っ込んでみた。現状の機能はこんな感じ。

- IX2207にコンソール接続するためのコンソールサーバー
- Prometheus & Grafanaによる監視サーバー
- ラジオ
- searXNGによる検索エンジンサーバー

Tailscaleを使用することでこれらのサーバーにどこからでもアクセスできる。コンテナやVMを使わず直接置いているので環境汚しまくりだ。しかしどのサーバーも実用しているわけではなくどちらかと言うとSandbox的に置いている感じなので最悪落ちても問題ない。一応それぞれのサービスを紹介しておく。

## IX2207にコンソール接続するためのコンソールサーバー

BMAXにIX2207をロールオーバーケーブルで常時直接接続しているのでBMAXにSSHしてscreenすればIX2207を設定できる。Tailscaleを用いているので外出先からでも設定可能だがBMAXはIX2207で構築されたネットワーク上に置いてあるという致命的な欠陥がある。これだと設定をミスるとBMAXにアクセスできなくなりIX2207にもアクセスできなくなってしまうだろう。一応BMAXを家のLANに直接配置してIX2207以下から外せば解決だが空いてるポートに何か挿しておきたいという欲望に負けてしまっている。まあでも実用はしないので問題ないだろう。

## Prometheus & Grafanaによる監視サーバー

それぞれがどういったものかの説明は省くがこれらを使用することでこんな感じでCPU使用率などのメトリクスを可視化することができる。

![](/img/grafana.png)

監視対象はBMAX本体とIX2207から取得できるSNMPだ。可視化するのは結構楽しい作業だがこういった監視システムで大事なのはどちらかというとアラート機能の方だろう。なのでメトリクスがある条件を満たした時にメールにアラートが飛ぶように設定してある。メールサーバーは自前で立てずにGMailを使用した。

まあこれにも致命的な欠陥があってまずBMAX上にある監視システムがBMAXを監視しているのでBMAXが落ちたら監視システムごと落ちる。IX2207も同じLANにいるのでIX2207に異常が発生->BMAXのネットワークが落ちる->監視サーバーにアクセスできなくなるといったことが起こる。なんて意味のない監視システムだろうか。

実用的な監視システムにしたいならば一番楽なのはクラウド上のサービスを使うことだろう。というか大体のものはクラウドにおく方が良い気がするのでMiniPCでこういったことをするのは本当にただの道楽だろう。一応技術検証になるし買い切りでお金がこれ以上かからないので全く意味がないわけではない...うん。

## ラジオ

いわゆるSDR(Software Defined Radio)だ。BMAX単体ではできなくて他で受信機を用意する必要があるが[受信機](https://www.amazon.co.jp/gp/product/B07HJTF8NH/ref=ppx_yo_dt_b_asin_title_o03_s00?ie=UTF8&psc=1)はすでに手元にあった。航空無線を聴くために買ったものだが家の中では全然聞こえないし空港に行くこともあんまりないので普通のラジオとして活用しようと言う目論見だ。

一応受信には成功したが本当にやりたいのはこれをUDP Streamingすることで、そうすると`nc -l -u bmax 7355 | play -t raw -r 48k -e signed-integer -b 16 -c 1 --buffer 100000 - -d`でTailscale越しでラジオを聞けるようになると思うのだがまだうまくいってない。

## searXNGによる検索エンジンサーバー

これはいくつかの検索エンジンを使用してそれらの結果をまとめてくれる感じのやつだ。Googleでそのまま検索するとトップに広告が出てきて煩わしいがsearXNG経由だと出てこないので嬉しい。使う検索エンジンを指定できるのでDockerやStackOverflow、GitHubの検索結果のみを表示するといった使い方もできる。検索速度が落ちるのが弱点だがそれは仕方がない。

![](/img/sear.png)

## そういえばOSは何

Manjaroを入れている。ローリングリリースなのがいいよね。KDEを使っていたのだがGUIの起動がなんか重くて起動するまでにコーヒー入れて飲むくらいができてしまっていた。動作時もCPU使用率がずっと3割くらいでなんか嫌だなと思っていたところでi3-wmを教えてもらったのでそっちに移行した。i3-wmはタイル式ウインドウマネージャで色々慣れは必要だがそれもまた面白い。起動も速くCPU使用率も3%以下でサーバー用途で軽くあって欲しいが一応GUIも欲しいという私の要望に答えてくれた。

## 実用的な使い方ないかなー

現状は全然活用できてないなという感じだ。試しにMisskeyとかMinecraftサーバーを置いておくか？きっとスペックが足りないが。
